<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>H.ai - your learning partner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- PDF.js for client-side PDF extraction -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  
  <!-- Bootstrap & Animations -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">

  <!-- Dyslexia Font -->
  <link href="https://cdn.jsdelivr.net/gh/antijingoist/open-dyslexic/webkit/opendyslexic.css" rel="stylesheet" >
  
  <!-- Markdown & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.2/dist/purify.min.js"></script>

  <style>
    :root {
      --primary-gradient: linear-gradient(135deg, #667eea 0%, hsl(328, 66%, 57%) 100%);
      --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --dark-primary: #2d3748;
      --dark-secondary: #1a202c;
      --accent-color: #805ad5;
      --text-light: #718096;
      --border-radius: 16px;
      --shadow-light: 0 10px 30px rgba(0,0,0,0.1);
      --shadow-hover: 0 20px 40px rgba(0,0,0,0.15);
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
      margin: 0;
      transition: var(--transition);
      line-height: 1.6;
    }

    /* Navigation Styles */
    .navbar {
      background: var(--primary-gradient);
      padding: 1rem 0;
      box-shadow: var(--shadow-light);
    }

    .navbar-brand {
      color: white !important;
      font-weight: bold;
      font-size: clamp(1.1rem, 2.5vw, 1.3rem);
    }

    .nav-pills .nav-link {
      color: rgba(255,255,255,0.8);
      margin: 0.2rem;
      border-radius: 8px;
      transition: var(--transition);
      padding: 0.5rem 0.75rem;
      font-size: clamp(0.8rem, 2vw, 0.9rem);
      white-space: nowrap;
    }

    .nav-pills .nav-link.active {
      background: rgba(255,255,255,0.2);
      color: white;
    }

    .nav-pills .nav-link:hover {
      background: rgba(255,255,255,0.1);
      color: white;
    }

    /* Mobile Navigation */
    .mobile-nav {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: var(--primary-gradient);
      padding: 0.5rem;
      z-index: 1000;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    }

    .mobile-nav .nav {
      justify-content: space-around;
    }

    .mobile-nav .nav-link {
      flex-direction: column;
      padding: 0.5rem;
      font-size: 0.7rem;
      text-align: center;
      min-width: 60px;
    }

    .mobile-nav .nav-link i {
      font-size: 1.2rem;
      margin-bottom: 0.25rem;
    }

    /* Main Container */
    .main-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-light);
      max-width: 1400px;
      margin: clamp(0.5rem, 2vw, 1rem) auto;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
      min-height: 85vh;
    }

    .content-area {
      padding: clamp(1rem, 3vw, 2rem);
    }

    /* Dynamic Sections */
    .section {
      display: none;
    }

    .section.active {
      display: block;
      animation: fadeIn 0.5s ease-in;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Card System */
    .card {
      background: white;
      border-radius: var(--border-radius);
      padding: clamp(1rem, 3vw, 1.5rem);
      box-shadow: var(--shadow-light);
      border: 1px solid rgba(0,0,0,0.05);
      transition: var(--transition);
      margin-bottom: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--primary-gradient);
    }

    .card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
    }

    /* Responsive Grid System */
    .responsive-grid {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    }

    .responsive-grid.two-col {
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    }

    /* Form Components */
    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      font-weight: 600;
      color: var(--dark-primary);
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }

    .form-control, .form-select {
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
      transition: var(--transition);
      background: white;
      width: 100%;
    }

    .form-control:focus, .form-select:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 3px rgba(128, 90, 213, 0.1);
      outline: none;
    }

    /* Buttons */
    .btn-custom {
      background: var(--primary-gradient);
      border: none;
      border-radius: 10px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      font-size: 1rem;
      color: white;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      justify-content: center;
      cursor: pointer;
      border: none;
    }

    .btn-custom:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-hover);
      color: white;
    }

    /* Notification Styles */
    .notifications-panel {
      position: fixed;
      top: 80px;
      right: 20px;
      width: 350px;
      max-height: 500px;
      background: white;
      border-radius: 15px;
      box-shadow: var(--shadow-hover);
      z-index: 2000;
      display: none;
      overflow: hidden;
    }

    .notification-item {
      padding: 1rem;
      border-bottom: 1px solid #e2e8f0;
      transition: var(--transition);
      cursor: pointer;
    }

    .notification-item:hover {
      background: #f8fafc;
    }

    .notification-item.unread {
      background: rgba(102, 126, 234, 0.05);
      border-left: 4px solid var(--accent-color);
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #ff4757;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }

    /* Teacher Dashboard Styles */
    .teacher-dashboard {
      display: grid;
      gap: 1.5rem;
    }

    .stats-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      padding: 1.5rem;
      text-align: center;
    }

    .stats-number {
      font-size: 2.5rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .class-card {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: var(--shadow-light);
      transition: var(--transition);
      cursor: pointer;
    }

    .class-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }

    /* Student Dashboard Styles */
    .student-class-card {
      background: white;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      padding: 1rem;
      transition: var(--transition);
      cursor: pointer;
      margin-bottom: 1rem;
    }

    .student-class-card:hover {
      border-color: var(--accent-color);
      transform: translateY(-2px);
    }

    .student-class-card.enrolled {
      border-color: var(--accent-color);
      background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
    }

    /* Video Components */
    .video-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .video-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: var(--shadow-light);
      transition: var(--transition);
      cursor: pointer;
    }

    .video-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-hover);
    }

    .video-thumbnail {
      width: 100%;
      height: 160px;
      object-fit: cover;
    }

    .video-info {
      padding: 1rem;
    }

    .video-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      line-height: 1.3;
      color: var(--dark-primary);
    }

    .video-meta {
      font-size: 0.75rem;
      color: var(--text-light);
      margin-bottom: 0.25rem;
    }

    /* Video Chat Interface */
    .video-chat-container {
      display: none;
      margin-top: 1rem;
      padding: 1rem;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      background: #f8fafc;
    }

    .video-chat-messages {
      max-height: 300px;
      overflow-y: auto;
      margin-bottom: 1rem;
      padding: 1rem;
      background: white;
      border-radius: 8px;
    }

    .video-chat-input {
      display: flex;
      gap: 0.5rem;
    }

    .video-chat-input input {
      flex: 1;
      padding: 0.5rem;
      border: 1px solid #ddd;
      border-radius: 6px;
    }

    /* Loading & Animation States */
    .loading-spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .progress-bar {
      height: 4px;
      background: #e2e8f0;
      border-radius: 2px;
      overflow: hidden;
      margin: 1rem 0;
    }

    .progress-fill {
      height: 100%;
      background: var(--success-gradient);
      width: 0%;
      transition: width 0.3s ease;
    }

    /* Chat Components */
    .chat-container {
      border: 2px solid #e2e8f0;
      border-radius: var(--border-radius);
      overflow: hidden;
      background: white;
      height: 70vh;
      display: flex;
      flex-direction: column;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: #f8fafc;
    }

    .chat-message {
      margin-bottom: 1rem;
      animation: slideInUp 0.3s ease-out;
    }

    .message-bubble {
      max-width: 85%;
      padding: 0.75rem 1rem;
      border-radius: 14px;
      position: relative;
      word-wrap: break-word;
      font-size: 0.9rem;
    }

    .message-bubble.user {
      background: var(--primary-gradient);
      color: white;
      margin-left: auto;
      border-bottom-right-radius: 4px;
    }

    .message-bubble.ai {
      background: white;
      border: 2px solid #e2e8f0;
      margin-right: auto;
      border-bottom-left-radius: 4px;
    }

    .chat-input-area {
      padding: 1rem;
      background: white;
      border-top: 2px solid #e2e8f0;
      display: flex;
      gap: 0.5rem;
      align-items: end;
    }

    .chat-input {
      flex: 1;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      padding: 0.5rem 0.75rem;
      resize: none;
      max-height: 80px;
      min-height: 36px;
      font-size: 0.9rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      .navbar .container {
        padding: 0 1rem;
      }
      
      .navbar .nav-pills {
        display: none;
      }
      
      .mobile-nav {
        display: block;
      }
      
      .main-container {
        margin: 0.5rem;
        border-radius: 12px;
        min-height: calc(100vh - 100px);
      }
      
      .content-area {
        padding: 1rem;
        padding-bottom: 5rem; /* Account for mobile nav */
      }
      
      .responsive-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
      }
      
      .video-grid {
        grid-template-columns: 1fr;
      }
      
      .video-thumbnail {
        height: 200px;
      }
      
      .notifications-panel {
        width: 90vw;
        right: 5vw;
        max-height: 60vh;
      }
    }

    @media (max-width: 480px) {
      .content-area {
        padding: 0.75rem;
      }
      
      .card {
        padding: 1rem;
      }
      
      .form-control, .form-select {
        padding: 0.5rem 0.75rem;
        font-size: 16px; /* Prevent zoom on iOS */
      }
      
      .btn-custom {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
      }
    }

    /* Modal Enhancements */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(5px);
    }

    .modal-overlay.show {
      display: flex;
      animation: fadeIn 0.3s ease-out;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      max-width: 90vw;
      max-height: 90vh;
      overflow: auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from { transform: scale(0.9) translateY(-20px); opacity: 0; }
      to { transform: scale(1) translateY(0); opacity: 1; }
    }

    /* Notification System */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      z-index: 3000;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--success-gradient);
    }

    .notification.error {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
    }

    .notification.info {
      background: var(--primary-gradient);
    }

    /* Audio Toggle */
    .audio-toggle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background: var(--primary-gradient);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    @keyframes slideInUp {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* File Upload Styles */
    .file-item {
      display: flex;
      justify-content: between;
      align-items: center;
      padding: 1rem;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 0.5rem;
      background: white;
    }

    .file-item:hover {
      background: #f8fafc;
    }

    /* Class Management Styles */
    .class-member-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem;
      border-bottom: 1px solid #e2e8f0;
    }

    .member-status {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-pending {
      background: #fef3c7;
      color: #d97706;
    }

    .status-accepted {
      background: #d1fae5;
      color: #059669;
    }

    .status-declined {
      background: #fecaca;
      color: #dc2626;
    }
  </style>
</head>

<body>
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg" role="navigation">
    <div class="container">
      <a class="navbar-brand" href="#"><i class="fas fa-brain" aria-hidden="true"></i> H.ai</a>
      
      <div class="navbar-nav">
        <ul class="nav nav-pills" id="desktop-nav">
          <li class="nav-item">
            <a class="nav-link active" href="#" data-section="home" role="button">
              <i class="fas fa-home" aria-hidden="true"></i> <span>Home</span>
            </a>
          </li>
          <li class="nav-item" id="learn-nav">
            <a class="nav-link" href="#" data-section="learn" role="button">
              <i class="fas fa-book" aria-hidden="true"></i> <span>Learn</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-section="videos" role="button">
              <i class="fas fa-video" aria-hidden="true"></i> <span>Videos</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-section="notes" role="button">
              <i class="fas fa-sticky-note" aria-hidden="true"></i> <span>Notes</span>
            </a>
          </li>
          <li class="nav-item" id="teacher-nav" style="display: none;">
            <a class="nav-link" href="#" data-section="teacher-dashboard" role="button">
              <i class="fas fa-chalkboard-teacher" aria-hidden="true"></i> <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item" id="student-nav" style="display: none;">
            <a class="nav-link" href="#" data-section="student-classes" role="button">
              <i class="fas fa-users" aria-hidden="true"></i> <span>Classes</span>
            </a>
          </li>
          <li class="nav-item" id="assessment-nav">
            <a class="nav-link" href="#" data-section="assessment" role="button">
              <i class="fas fa-clipboard-check" aria-hidden="true"></i> <span>Assessment</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-section="profile" role="button">
              <i class="fas fa-user" aria-hidden="true"></i> <span>Profile</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="d-flex align-items-center">
        <div class="position-relative me-3">
          <button class="btn btn-sm btn-outline-light" id="notifications-btn" onclick="toggleNotifications()">
            <i class="fas fa-bell" aria-hidden="true"></i>
            <span class="notification-badge" id="notification-count" style="display: none;">0</span>
          </button>
        </div>
        <span class="user-info text-white me-2" id="user-welcome">Welcome!</span>
        <a href="/logout" class="btn btn-sm btn-outline-light">
          <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout
        </a>
      </div>
    </div>
  </nav>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav" role="navigation" aria-label="Mobile navigation">
    <ul class="nav">
      <li class="nav-item">
        <a class="nav-link active" href="#" data-section="home" role="button">
          <i class="fas fa-home" aria-hidden="true"></i>
          <span>Home</span>
        </a>
      </li>
      <li class="nav-item" id="mobile-learn-nav">
        <a class="nav-link" href="#" data-section="learn" role="button">
          <i class="fas fa-book" aria-hidden="true"></i>
          <span>Learn</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" data-section="videos" role="button">
          <i class="fas fa-video" aria-hidden="true"></i>
          <span>Videos</span>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" data-section="notes" role="button">
          <i class="fas fa-sticky-note" aria-hidden="true"></i>
          <span>Notes</span>
        </a>
      </li>
      <li class="nav-item" id="mobile-teacher-nav" style="display: none;">
        <a class="nav-link" href="#" data-section="teacher-dashboard" role="button">
          <i class="fas fa-chalkboard-teacher" aria-hidden="true"></i>
          <span>Teach</span>
        </a>
      </li>
      <li class="nav-item" id="mobile-student-nav" style="display: none;">
        <a class="nav-link" href="#" data-section="student-classes" role="button">
          <i class="fas fa-users" aria-hidden="true"></i>
          <span>Classes</span>
        </a>
      </li>
      <li class="nav-item" id="mobile-assessment-nav">
        <a class="nav-link" href="#" data-section="assessment" role="button">
          <i class="fas fa-clipboard-check" aria-hidden="true"></i>
          <span>Test</span>
        </a>
      </li>
    </ul>
  </nav>

  <!-- Notifications Panel -->
  <div class="notifications-panel" id="notifications-panel">
    <div class="p-3 border-bottom bg-primary text-white">
      <div class="d-flex justify-content-between align-items-center">
        <h6 class="mb-0">Notifications</h6>
        <button class="btn btn-sm btn-outline-light" onclick="toggleNotifications()">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>
    <div id="notifications-list" style="max-height: 400px; overflow-y: auto;">
      <div class="text-center p-4 text-muted">
        <i class="fas fa-bell fa-2x mb-2"></i>
        <p>No notifications</p>
      </div>
    </div>
  </div>

  <div class="main-container">
    <main class="content-area" id="main-content">

      <!-- Home Section -->
      <section class="section active" id="home-section" aria-labelledby="home-heading">
        <div class="text-center mb-4">
          <h1 id="home-heading" class="display-5 mb-3">Welcome to H.ai</h1>
          <p class="lead text-muted">Your intelligent learning companion for accessible education</p>
        </div>

        <div class="responsive-grid">
          <div class="card">
            <h3><i class="fas fa-upload text-primary" aria-hidden="true"></i> Document Learning</h3>
            <p>Upload PDF, DOCX, or text documents and get AI-powered summaries with optional audio support in multiple Indian languages.</p>
            <ul class="list-unstyled mt-3">
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Fast client-side PDF extraction</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Multi-language support including Hindi, Telugu</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Optional text-to-speech in Indian languages</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Interactive Q&A with AI</li>
            </ul>
          </div>
          
          <div class="card">
            <h3><i class="fas fa-video text-success" aria-hidden="true"></i> Enhanced Video Learning</h3>
            <p>Search educational videos, get transcripts, and chat with AI about video content for better understanding.</p>
            <ul class="list-unstyled mt-3">
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>AI-powered video search</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Automatic transcript extraction</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Video content chat with AI</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Educational video recommendations</li>
            </ul>
          </div>

          <div class="card" id="teacher-features" style="display: none;">
            <h3><i class="fas fa-chalkboard-teacher text-info" aria-hidden="true"></i> Teacher Dashboard</h3>
            <p>Create and manage classes, track student progress, upload files, and communicate with students effectively.</p>
            <ul class="list-unstyled mt-3">
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Class creation and management</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Student progress tracking</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>File sharing and announcements</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Direct student messaging</li>
            </ul>
          </div>

          <div class="card" id="student-features" style="display: none;">
            <h3><i class="fas fa-user-graduate text-warning" aria-hidden="true"></i> Student Features</h3>
            <p>Join classes, access shared resources, receive notifications, and interact with teachers and content.</p>
            <ul class="list-unstyled mt-3">
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Class membership and discovery</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Real-time notifications</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Access to class files and resources</li>
              <li><i class="fas fa-check text-success me-2" aria-hidden="true"></i>Progress tracking and assessments</li>
            </ul>
          </div>

          <div class="card">
            <h3><i class="fas fa-universal-access text-warning" aria-hidden="true"></i> Accessibility Features</h3>
            <div class="row">
              <div class="col-md-6">
                <h5>Visual Accessibility</h5>
                <ul class="list-unstyled">
                  <li><i class="fas fa-eye me-2" aria-hidden="true"></i>Dyslexia-friendly fonts</li>
                  <li><i class="fas fa-adjust me-2" aria-hidden="true"></i>High contrast options</li>
                  <li><i class="fas fa-search-plus me-2" aria-hidden="true"></i>Responsive design</li>
                </ul>
              </div>
              <div class="col-md-6">
                <h5>Audio & Language</h5>
                <ul class="list-unstyled">
                  <li><i class="fas fa-volume-up me-2" aria-hidden="true"></i>Optional text-to-speech</li>
                  <li><i class="fas fa-language me-2" aria-hidden="true"></i>Indian language support</li>
                  <li><i class="fas fa-download me-2" aria-hidden="true"></i>Audio downloads</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Learn Section -->
      <section class="section" id="learn-section" aria-labelledby="learn-heading">
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
          <h2 id="learn-heading"><i class="fas fa-book" aria-hidden="true"></i> Document Learning</h2>
        </div>

        <div class="responsive-grid two-col">
          <!-- Upload and Summary Panel -->
          <div class="card">
            <h4><i class="fas fa-cloud-upload-alt text-primary" aria-hidden="true"></i> Upload & Process</h4>
            
            <form id="upload-form" class="form-section" role="form">
              <div class="form-group">
                <label class="form-label" for="file-input">
                  <i class="fas fa-file-alt" aria-hidden="true"></i> Upload File (.pdf, .txt, .docx)
                </label>
                <input type="file" class="form-control" name="file" id="file-input" accept=".pdf,.txt,.docx,.csv" required>
                <div class="form-text">Supported formats: PDF, Word documents, text files</div>
              </div>

              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label" for="summary-language">Summary Language</label>
                  <select class="form-select" name="language" id="summary-language">
                    <option value="English">üá∫üá∏ English</option>
                    <option value="Hindi">üáÆüá≥ Hindi (‡§π‡§ø‡§Ç‡§¶‡•Ä)</option>
                    <option value="Telugu">üáÆüá≥ Telugu (‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å)</option>
                    <option value="Tamil">üáÆüá≥ Tamil (‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç)</option>
                    <option value="Marathi">üáÆüá≥ Marathi (‡§Æ‡§∞‡§æ‡§†‡•Ä)</option>
                    <option value="Bengali">üáÆüá≥ Bengali (‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ)</option>
                    <option value="Gujarati">üáÆüá≥ Gujarati (‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä)</option>
                    <option value="Punjabi">üáÆüá≥ Punjabi (‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä)</option>
                    <option value="Kannada">üáÆüá≥ Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)</option>
                    <option value="Malayalam">üáÆüá≥ Malayalam (‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç)</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="audio-language">Audio Language</label>
                  <select class="form-select" name="gtts_lang" id="audio-language">
                    <option value="en">üá∫üá∏ English</option>
                    <option value="hi">üáÆüá≥ Hindi</option>
                    <option value="te">üáÆüá≥ Telugu</option>
                    <option value="ta">üáÆüá≥ Tamil</option>
                    <option value="mr">üáÆüá≥ Marathi</option>
                    <option value="bn">üáÆüá≥ Bengali</option>
                    <option value="gu">üáÆüá≥ Gujarati</option>
                    <option value="pa">üáÆüá≥ Punjabi</option>
                    <option value="kn">üáÆüá≥ Kannada</option>
                    <option value="ml">üáÆüá≥ Malayalam</option>
                  </select>
                </div>
              </div>

              <!-- Audio Toggle -->
              <div class="audio-toggle">
                <label class="form-label mb-0" for="include-audio-toggle">
                  <i class="fas fa-volume-up" aria-hidden="true"></i> Include Audio Summary
                </label>
                <label class="toggle-switch">
                  <input type="checkbox" id="include-audio-toggle" name="include_audio" checked>
                  <span class="slider"></span>
                </label>
              </div>

              <button type="submit" class="btn-custom w-100 mt-3">
                <i class="fas fa-magic" aria-hidden="true"></i> Generate Summary
              </button>
            </form>

            <div class="progress-bar" id="progress-bar" style="display: none;">
              <div class="progress-fill" id="progress-fill"></div>
            </div>

            <!-- Summary Display -->
            <div id="summary-section" style="display: none;">
              <h5 class="mt-4"><i class="fas fa-file-text text-success" aria-hidden="true"></i> Summary</h5>
              <div id="summary-content" class="p-3 bg-light rounded border"></div>
              
              <div class="mt-3" id="audio-section">
                <label class="form-label" for="audio-player">Audio Summary</label>
                <audio controls class="w-100" id="audio-player">
                  <source id="audio-source" type="audio/mp3">
                  Your browser does not support the audio element.
                </audio>
              </div>
            </div>
          </div>

          <!-- Chat Panel -->
          <div class="card">
            <h4><i class="fas fa-comments text-info" aria-hidden="true"></i> Ask Questions</h4>
            
            <div class="chat-container">
              <div class="chat-messages" id="chat-messages" role="log" aria-live="polite" aria-label="Chat messages">
                <div class="chat-message">
                  <div class="message-bubble ai">
                    <strong><i class="fas fa-robot" aria-hidden="true"></i> H.ai:</strong>
                    <p>Hello! Upload a document and I'll help you understand it better. Ask me anything!</p>
                  </div>
                </div>
              </div>
              
              <div class="chat-input-area">
                <textarea class="chat-input" id="user-question" placeholder="Ask about the document..." rows="1" aria-label="Type your question here"></textarea>
                <button class="btn-custom" id="ask-btn" aria-label="Send message">
                  <i class="fas fa-paper-plane" aria-hidden="true"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Teacher Dashboard Section -->
      <section class="section" id="teacher-dashboard-section" aria-labelledby="teacher-heading">
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
          <h2 id="teacher-heading"><i class="fas fa-chalkboard-teacher" aria-hidden="true"></i> Teacher Dashboard</h2>
          <button class="btn-custom" onclick="showCreateClassModal()" aria-label="Create new class">
            <i class="fas fa-plus" aria-hidden="true"></i> Create Class
          </button>
        </div>

        <!-- Teacher Stats -->
        <div class="responsive-grid mb-4">
          <div class="stats-card">
            <div class="stats-number" id="total-classes">0</div>
            <div>Total Classes</div>
          </div>
          <div class="stats-card">
            <div class="stats-number" id="total-students">0</div>
            <div>Total Students</div>
          </div>
          <div class="stats-card">
            <div class="stats-number" id="pending-requests">0</div>
            <div>Pending Requests</div>
          </div>
        </div>

        <!-- Teacher Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="teacher-tabs">
          <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#teacher-home">
              <i class="fas fa-home"></i> Home
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#teacher-students">
              <i class="fas fa-users"></i> Students
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#teacher-content">
              <i class="fas fa-folder-open"></i> Content Hub
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#teacher-announcements">
              <i class="fas fa-bullhorn"></i> Announcements
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#teacher-ai">
              <i class="fas fa-robot"></i> AI Assistant
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#teacher-reports">
              <i class="fas fa-chart-bar"></i> Reports
            </a>
          </li>
        </ul>

        <div class="tab-content">
          <!-- Teacher Home Tab -->
          <div class="tab-pane fade show active" id="teacher-home">
            <div class="responsive-grid">
              <div class="card">
                <h4><i class="fas fa-clipboard-list text-primary"></i> My Classes</h4>
                <div id="teacher-classes-list">
                  <div class="text-center text-muted py-4">
                    <i class="fas fa-plus-circle fa-3x mb-3"></i>
                    <p>No classes yet. Create your first class!</p>
                  </div>
                </div>
              </div>

              <div class="card">
                <h4><i class="fas fa-clock text-info"></i> Recent Activity</h4>
                <div id="teacher-recent-activity">
                  <div class="text-center text-muted py-4">
                    <i class="fas fa-history fa-3x mb-3"></i>
                    <p>Recent activities will appear here</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Students Management Tab -->
          <div class="tab-pane fade" id="teacher-students">
            <div class="card">
              <h4><i class="fas fa-users text-success"></i> Student Management</h4>
              
              <!-- Class Selection -->
              <div class="mb-3">
                <label class="form-label">Select Class:</label>
                <select class="form-select" id="class-filter" onchange="filterStudentsByClass()">
                  <option value="">All Classes</option>
                </select>
              </div>

              <div id="students-list" class="mt-3">
                <div class="text-center text-muted py-4">
                  <i class="fas fa-users fa-3x mb-3"></i>
                  <p>Students will appear here when you create classes</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Content Hub Tab -->
          <div class="tab-pane fade" id="teacher-content">
            <div class="row g-3">
              <div class="col-md-8">
                <div class="card">
                  <h4><i class="fas fa-folder-open text-warning"></i> Class Files</h4>
                  
                  <div class="mb-3">
                    <label class="form-label">Select Class for File Upload:</label>
                    <select class="form-select" id="file-upload-class">
                      <option value="">Select a class</option>
                    </select>
                  </div>

                  <form id="file-upload-form" style="display: none;">
                    <div class="row g-3 mb-3">
                      <div class="col-md-8">
                        <input type="file" class="form-control" id="class-file-input" required>
                      </div>
                      <div class="col-md-4">
                        <button type="submit" class="btn btn-primary w-100">
                          <i class="fas fa-upload"></i> Upload
                        </button>
                      </div>
                    </div>
                    <div class="mb-3">
                      <input type="text" class="form-control" id="file-description" placeholder="File description (optional)">
                    </div>
                  </form>

                  <div id="class-files-list"></div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="card">
                  <h5><i class="fas fa-info-circle text-info"></i> Upload Guidelines</h5>
                  <ul class="list-unstyled small">
                    <li><i class="fas fa-check text-success me-1"></i> Max file size: 50MB</li>
                    <li><i class="fas fa-check text-success me-1"></i> Supported formats: PDF, DOC, DOCX, PPT, PPTX, TXT</li>
                    <li><i class="fas fa-check text-success me-1"></i> All class members will be notified</li>
                    <li><i class="fas fa-check text-success me-1"></i> Files are accessible to all class members</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- Announcements Tab -->
          <div class="tab-pane fade" id="teacher-announcements">
            <div class="card">
              <h4><i class="fas fa-bullhorn text-danger"></i> Announcements</h4>
              
              <form id="announcement-form" class="mb-4">
                <div class="row g-3">
                  <div class="col-md-6">
                    <label class="form-label">Class:</label>
                    <select class="form-select" id="announcement-class" required>
                      <option value="">Select a class</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label class="form-label">Priority:</label>
                    <select class="form-select" id="announcement-priority">
                      <option value="normal">Normal</option>
                      <option value="high">High</option>
                      <option value="urgent">Urgent</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <input type="text" class="form-control" id="announcement-title" placeholder="Announcement title" required>
                  </div>
                  <div class="col-12">
                    <textarea class="form-control" id="announcement-content" rows="4" placeholder="Type your announcement here..." required></textarea>
                  </div>
                  <div class="col-12">
                    <button type="submit" class="btn btn-primary">
                      <i class="fas fa-paper-plane"></i> Send Announcement
                    </button>
                  </div>
                </div>
              </form>

              <div id="announcements-list"></div>
            </div>
          </div>

          <!-- AI Assistant Tab -->
          <div class="tab-pane fade" id="teacher-ai">
            <div class="card">
              <h4><i class="fas fa-robot text-primary"></i> AI Teaching Assistant</h4>
              <p class="text-muted">Get AI help for creating lesson plans, assessments, and managing your classes.</p>
              
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h5><i class="fas fa-clipboard-list"></i> Create Lesson Plan</h5>
                      <p class="small">Generate comprehensive lesson plans for your subjects.</p>
                      <button class="btn btn-outline-primary btn-sm" onclick="showAILessonPlan()">
                        Get Started
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h5><i class="fas fa-question-circle"></i> Generate Quiz</h5>
                      <p class="small">Create quizzes and assessments automatically.</p>
                      <button class="btn btn-outline-primary btn-sm" onclick="showAIQuizGenerator()">
                        Generate Quiz
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h5><i class="fas fa-chart-line"></i> Student Insights</h5>
                      <p class="small">Get AI insights about student performance.</p>
                      <button class="btn btn-outline-primary btn-sm" onclick="showStudentInsights()">
                        View Insights
                      </button>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card h-100">
                    <div class="card-body">
                      <h5><i class="fas fa-comments"></i> Teaching Tips</h5>
                      <p class="small">Get personalized teaching recommendations.</p>
                      <button class="btn btn-outline-primary btn-sm" onclick="showTeachingTips()">
                        Get Tips
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Reports Tab -->
          <div class="tab-pane fade" id="teacher-reports">
            <div class="card">
              <h4><i class="fas fa-chart-bar text-success"></i> Student Reports & Analytics</h4>
              
              <div class="mb-3">
                <label class="form-label">Select Class for Reports:</label>
                <select class="form-select" id="reports-class-filter">
                  <option value="">All Classes</option>
                </select>
              </div>

              <div id="teacher-reports-content">
                <div class="text-center text-muted py-5">
                  <i class="fas fa-chart-bar fa-3x mb-3"></i>
                  <p>Student reports and analytics will appear here</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Student Classes Section -->
      <section class="section" id="student-classes-section" aria-labelledby="student-classes-heading">
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
          <h2 id="student-classes-heading"><i class="fas fa-users" aria-hidden="true"></i> My Classes</h2>
        </div>

        <!-- Student Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="student-tabs">
          <li class="nav-item">
            <a class="nav-link active" data-bs-toggle="tab" href="#enrolled-classes">
              <i class="fas fa-users"></i> My Classes
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#available-classes">
              <i class="fas fa-search"></i> Browse Classes
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-bs-toggle="tab" href="#student-notifications" onclick="loadNotifications()">
              <i class="fas fa-bell"></i> Notifications
              <span class="badge bg-danger ms-1" id="mobile-notification-badge" style="display: none;">0</span>
            </a>
          </li>
        </ul>

        <div class="tab-content">
          <!-- Enrolled Classes Tab -->
          <div class="tab-pane fade show active" id="enrolled-classes">
            <div id="student-enrolled-classes">
              <div class="text-center text-muted py-5">
                <i class="fas fa-users fa-3x mb-3"></i>
                <p>You haven't joined any classes yet. Browse available classes to get started!</p>
              </div>
            </div>
          </div>

          <!-- Available Classes Tab -->
          <div class="tab-pane fade" id="available-classes">
            <div class="card mb-4">
              <div class="card-body">
                <h5><i class="fas fa-search"></i> Discover Classes</h5>
                <p class="text-muted mb-3">Find and join classes created by teachers. You can request to join any class that interests you.</p>
              </div>
            </div>
            
            <div id="student-available-classes">
              <div class="text-center text-muted py-5">
                <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                <p>Loading available classes...</p>
              </div>
            </div>
          </div>

          <!-- Notifications Tab -->
          <div class="tab-pane fade" id="student-notifications">
            <div class="card">
              <div class="card-header">
                <h5><i class="fas fa-bell"></i> Notifications</h5>
              </div>
              <div id="student-notifications-list">
                <div class="text-center text-muted py-4">
                  <i class="fas fa-spinner fa-spin fa-2x mb-3"></i>
                  <p>Loading notifications...</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Videos Section -->
      <section class="section" id="videos-section" aria-labelledby="videos-heading">
        <h2 id="videos-heading"><i class="fas fa-video" aria-hidden="true"></i> Educational Videos</h2>
        
        <div class="card">
          <div class="row g-3">
            <div class="col-md-8">
              <input type="text" class="form-control" id="video-search" placeholder="Search for educational videos..." aria-label="Search for videos">
            </div>
            <div class="col-md-4">
              <button class="btn-custom w-100" onclick="searchVideos()">
                <i class="fas fa-search" aria-hidden="true"></i> Search Videos
              </button>
            </div>
          </div>
        </div>

        <div id="videos-container">
          <div class="text-center text-muted mt-4">
            <i class="fas fa-search fa-3x mb-3" aria-hidden="true"></i>
            <p>Search for educational videos to get started</p>
          </div>
        </div>
      </section>

      <!-- Notes Section -->
      <section class="section" id="notes-section" aria-labelledby="notes-heading">
        <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
          <h2 id="notes-heading"><i class="fas fa-sticky-note" aria-hidden="true"></i> My Notes</h2>
          <div class="d-flex gap-2">
            <button class="btn btn-info" onclick="showAINotesGenerator()" id="ai-notes-btn">
              <i class="fas fa-robot" aria-hidden="true"></i> AI Write Notes
            </button>
            <button class="btn-custom" onclick="createNewNote()">
              <i class="fas fa-plus" aria-hidden="true"></i> New Note
            </button>
          </div>
        </div>

        <!-- AI Notes Generator -->
        <div id="ai-notes-generator" style="display: none;">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-robot" aria-hidden="true"></i> AI Notes Generator</h5>
                <button class="btn btn-sm btn-outline-light" onclick="hideAINotesGenerator()">
                  <i class="fas fa-times" aria-hidden="true"></i>
                </button>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label" for="ai-notes-prompt"><i class="fas fa-lightbulb" aria-hidden="true"></i> What would you like notes about?</label>
                <textarea 
                  class="form-control" 
                  id="ai-notes-prompt" 
                  rows="4" 
                  placeholder="Example: Create comprehensive notes about photosynthesis with diagrams and tables, or summarize the uploaded document with key points and flowcharts..."
                ></textarea>
              </div>
              
              <div class="row g-3 mb-3">
                <div class="col-md-6">
                  <label class="form-label" for="ai-notes-style">Note Style</label>
                  <select class="form-select" id="ai-notes-style">
                    <option value="comprehensive">üìö Comprehensive Study Notes</option>
                    <option value="summary">üìù Summary with Key Points</option>
                    <option value="structured">üóÇÔ∏è Structured with Tables</option>
                    <option value="visual">üìä Visual with Diagrams</option>
                    <option value="outline">üìã Outline Format</option>
                  </select>
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="ai-notes-features">Include</label>
                  <select class="form-select" id="ai-notes-features">
                    <option value="all">üéØ Everything (Tables, Diagrams, Examples)</option>
                    <option value="tables">üìä Focus on Tables & Charts</option>
                    <option value="diagrams">üîÑ Focus on Flow Diagrams</option>
                    <option value="examples">üí° Focus on Examples</option>
                    <option value="definitions">üìñ Focus on Definitions</option>
                  </select>
                </div>
              </div>
              
              <div class="d-flex gap-2">
                <button class="btn btn-primary" onclick="generateAINotes()" id="generate-ai-notes-btn">
                  <i class="fas fa-magic" aria-hidden="true"></i> Generate Notes
                </button>
                <button class="btn btn-secondary" onclick="useCurrentSummary()" id="use-summary-btn" disabled>
                  <i class="fas fa-file-text" aria-hidden="true"></i> Use Current Document
                </button>
              </div>
              
              <!-- AI Notes Preview -->
              <div id="ai-notes-preview" style="display: none;" class="mt-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h6><i class="fas fa-eye" aria-hidden="true"></i> Generated Notes Preview</h6>
                  <div class="d-flex gap-2">
                    <button class="btn btn-sm btn-success" onclick="saveAINotesToEditor()">
                      <i class="fas fa-save" aria-hidden="true"></i> Save as Note
                    </button>
                    <button class="btn btn-sm btn-outline-primary" onclick="regenerateAINotes()">
                      <i class="fas fa-redo" aria-hidden="true"></i> Regenerate
                    </button>
                  </div>
                </div>
                <div id="ai-notes-content" class="border rounded p-3 bg-light" style="max-height: 400px; overflow-y: auto;"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Notes List View -->
        <div id="notes-list-view">
          <div id="notes-grid">
            <div class="text-center text-muted mt-5 w-100">
              <i class="fas fa-sticky-note fa-3x mb-3" aria-hidden="true"></i>
              <p>No notes yet. Create your first note!</p>
            </div>
          </div>
        </div>

        <!-- Note Editor View -->
        <div id="note-editor-view" style="display: none;">
          <div class="card">
            <div class="card-header">
              <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                <div class="d-flex align-items-center gap-3">
                  <button class="btn btn-outline-secondary" onclick="backToNotesList()">
                    <i class="fas fa-arrow-left" aria-hidden="true"></i> Back
                  </button>
                  <input type="text" id="note-title" class="form-control" placeholder="Note Title..." value="Untitled Note" style="min-width: 200px;">
                </div>
                <div class="d-flex gap-2 flex-wrap">
                  <button class="btn btn-success" onclick="saveNote()">
                    <i class="fas fa-save" aria-hidden="true"></i> Save
                  </button>
                  <button class="btn btn-primary" onclick="downloadNotePDF()">
                    <i class="fas fa-download" aria-hidden="true"></i> PDF
                  </button>
                  <button class="btn btn-danger" onclick="deleteCurrentNote()" id="delete-note-btn" style="display: none;">
                    <i class="fas fa-trash" aria-hidden="true"></i>
                  </button>
                </div>
              </div>
            </div>
            
            <div class="card-body">
              <div id="note-editor" contenteditable="true" style="min-height: 400px; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 8px; outline: none;">
                <p>Start writing your note here...</p>
              </div>
            </div>
            
            <!-- Editor Toolbar -->
            <div class="card-footer">
              <div class="d-flex flex-wrap gap-2 align-items-center">
                <div class="btn-group" role="group">
                  <button class="btn btn-sm btn-outline-secondary" onclick="formatText('bold')" title="Bold">
                    <i class="fas fa-bold" aria-hidden="true"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="formatText('italic')" title="Italic">
                    <i class="fas fa-italic" aria-hidden="true"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="formatText('underline')" title="Underline">
                    <i class="fas fa-underline" aria-hidden="true"></i>
                  </button>
                </div>
                <div class="btn-group" role="group">
                  <button class="btn btn-sm btn-outline-secondary" onclick="formatText('insertUnorderedList')" title="Bullet List">
                    <i class="fas fa-list-ul" aria-hidden="true"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-secondary" onclick="formatText('insertOrderedList')" title="Numbered List">
                    <i class="fas fa-list-ol" aria-hidden="true"></i>
                  </button>
                </div>
                <select class="form-select form-select-sm" style="width: auto;" onchange="changeFontSize(this.value)">
                  <option value="12px">12px</option>
                  <option value="14px">14px</option>
                  <option value="16px" selected>16px</option>
                  <option value="18px">18px</option>
                  <option value="20px">20px</option>
                  <option value="24px">24px</option>
                </select>
                <button class="btn btn-sm btn-outline-secondary" onclick="insertCurrentDate()" title="Insert Date">
                  <i class="fas fa-calendar" aria-hidden="true"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="clearContent()" title="Clear All">
                  <i class="fas fa-eraser" aria-hidden="true"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Assessment Section -->
      <section class="section" id="assessment-section" aria-labelledby="assessment-heading">
        <h2 id="assessment-heading"><i class="fas fa-clipboard-check" aria-hidden="true"></i> Assessment</h2>
        
        <div class="card" id="assessment-start">
          <div class="text-center">
            <i class="fas fa-clipboard-list fa-3x text-primary mb-3" aria-hidden="true"></i>
            <h4>Ready to Test Your Knowledge?</h4>
            <p class="text-muted">Upload and process a document first, then generate an assessment to test your understanding.</p>
            <button class="btn-custom" onclick="generateAssessment()" id="generate-btn">
              <i class="fas fa-magic" aria-hidden="true"></i> Generate Assessment
            </button>
          </div>
        </div>

        <div class="card" id="assessment-quiz" style="display: none;">
          <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
            <h4><i class="fas fa-question-circle" aria-hidden="true"></i> Assessment Quiz</h4>
            <div class="badge bg-primary fs-6" id="question-counter">Question 1 of 5</div>
          </div>
          
          <div id="questions-container"></div>
          
          <div class="text-center mt-4">
            <button class="btn-custom" onclick="submitAssessment()" id="submit-assessment">
              <i class="fas fa-paper-plane" aria-hidden="true"></i> Submit Assessment
            </button>
          </div>
        </div>

        <div class="card" id="assessment-results" style="display: none;">
          <div class="text-center">
            <div id="result-icon" class="mb-3"></div>
            <h3 id="result-title"></h3>
            <div class="row mt-4 g-3">
              <div class="col-6 col-md-3">
                <div class="assessment-card text-center">
                  <div class="assessment-score" id="score-display">0%</div>
                  <small class="text-muted">Score</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="assessment-card text-center">
                  <div class="assessment-score text-success" id="correct-display">0/5</div>
                  <small class="text-muted">Correct</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="assessment-card text-center">
                  <div class="assessment-score" id="status-display">Failed</div>
                  <small class="text-muted">Status</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="assessment-card text-center">
                  <div class="assessment-score text-info">80%</div>
                  <small class="text-muted">Pass Mark</small>
                </div>
              </div>
            </div>
            
            <div class="mt-4">
              <h5>AI Feedback</h5>
              <div id="ai-feedback" class="p-3 bg-light rounded text-start border"></div>
            </div>
            
            <button class="btn-custom mt-3" onclick="resetAssessment()">
              <i class="fas fa-redo" aria-hidden="true"></i> Take Another Assessment
            </button>
          </div>
        </div>
      </section>

      <!-- Profile Section -->
      <section class="section" id="profile-section" aria-labelledby="profile-heading">
        <div class="card bg-primary text-white">
          <div class="row align-items-center">
            <div class="col-md-8">
              <h2 id="profile-heading"><i class="fas fa-user-circle" aria-hidden="true"></i> Profile</h2>
              <p class="mb-1" id="profile-username">Loading...</p>
              <p class="mb-0" id="profile-email">Loading...</p>
              <span class="badge bg-light text-primary mt-2" id="profile-role">Student</span>
            </div>
            <div class="col-md-4 text-end">
              <a href="/logout" class="btn btn-light">
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i> Logout
              </a>
            </div>
          </div>
        </div>

        <div class="responsive-grid">
          <div class="card">
            <h3><i class="fas fa-chart-bar" aria-hidden="true"></i> Assessment Dashboard</h3>
            <div id="assessment-dashboard">
              <div class="text-center text-muted">
                <i class="fas fa-spinner fa-spin fa-2x mb-3" aria-hidden="true"></i>
                <p>Loading assessment data...</p>
              </div>
            </div>
          </div>

          <div class="card">
            <h3><i class="fas fa-history" aria-hidden="true"></i> Recent Activity</h3>
            <div id="activities-container">
              <div class="text-center text-muted">
                <i class="fas fa-spinner fa-spin fa-2x mb-3" aria-hidden="true"></i>
                <p>Loading activities...</p>
              </div>
            </div>
          </div>
        </div>
      </section>

    </main>
  </div>

  <!-- Modals -->
  <!-- Create Class Modal -->
  <div class="modal-overlay" id="create-class-modal">
    <div class="modal-content" style="width: 90%; max-width: 600px; padding: 2rem;">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3><i class="fas fa-plus-circle text-primary"></i> Create New Class</h3>
        <button class="btn btn-sm btn-outline-secondary" onclick="closeCreateClassModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form id="create-class-form">
        <div class="mb-3">
          <label class="form-label">Class Name</label>
          <input type="text" class="form-control" id="new-class-name" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Description</label>
          <textarea class="form-control" id="new-class-description" rows="3"></textarea>
        </div>
        <div class="mb-3">
          <label class="form-label">Select Students</label>
          <div class="border rounded p-3" style="max-height: 300px; overflow-y: auto;" id="students-selection">
            <div class="text-center text-muted">
              <i class="fas fa-spinner fa-spin"></i> Loading students...
            </div>
          </div>
        </div>
        <div class="d-flex justify-content-end gap-2">
          <button type="button" class="btn btn-secondary" onclick="closeCreateClassModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-plus"></i> Create Class
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Video Player Modal -->
  <div class="modal-overlay" id="video-modal">
    <div class="modal-content" style="width: 95%; max-width: 1200px; padding: 0;">
      <div class="d-flex justify-content-between align-items-center p-3 bg-dark text-white">
        <h5 class="mb-0" id="video-modal-title">Video Player</h5>
        <button class="btn btn-sm btn-outline-light" onclick="closeVideoModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="video-content">
        <div class="ratio ratio-16x9">
          <iframe id="video-iframe" src="" allowfullscreen></iframe>
        </div>
        <!-- Video Chat Section -->
        <div class="video-chat-container" id="video-chat-section">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h6><i class="fas fa-comments"></i> Ask about this video</h6>
            <button class="btn btn-sm btn-primary" onclick="loadVideoTranscript()" id="load-transcript-btn">
              <i class="fas fa-file-text"></i> Load Transcript
            </button>
          </div>
          
          <div class="video-chat-messages" id="video-chat-messages">
            <div class="text-center text-muted p-3">
              <i class="fas fa-play-circle fa-2x mb-2"></i>
              <p>Load the video transcript to start asking questions about the content!</p>
            </div>
          </div>
          
          <div class="video-chat-input">
            <input type="text" id="video-question-input" placeholder="Ask a question about the video..." disabled>
            <button class="btn btn-primary" onclick="askVideoQuestion()" id="ask-video-btn" disabled>
              <i class="fas fa-paper-plane"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification Container -->
  <div id="notification-container" aria-live="polite" aria-atomic="true"></div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Global Variables
    let currentUser = null;
    let summaryContext = '';
    let isProcessing = false;
    let currentSection = 'home';
    let currentNoteId = null;
    let userNotes = [];
    let generatedAIContent = '';
    let currentAssessment = null;
    let userAnswers = [];
    let currentVideoId = null;
    let currentVideoTranscript = null;
    let notifications = [];
    let unreadNotifications = 0;

    // PDF.js Configuration
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    // Initialize Application
    document.addEventListener('DOMContentLoaded', function() {
      loadUserInfo();
      setupNavigation();
      setupEventListeners();
      setupPDFExtraction();
      loadNotifications();
      
      // Load notifications every 30 seconds
      setInterval(loadNotifications, 30000);
    });

    // User Management Functions
    function loadUserInfo() {
      fetch('/get_user_info')
        .then(response => response.json())
        .then(data => {
          if (data.id) {
            currentUser = data;
            document.getElementById('user-welcome').textContent = `Welcome, ${data.username}!`;
            document.getElementById('profile-username').textContent = data.username;
            document.getElementById('profile-email').textContent = data.email;
            document.getElementById('profile-role').textContent = data.role || 'Student';
            
            // Show/hide features based on role
            if (data.role === 'teacher') {
              document.getElementById('teacher-nav').style.display = 'block';
              document.getElementById('mobile-teacher-nav').style.display = 'block';
              document.getElementById('teacher-features').style.display = 'block';
              loadTeacherDashboard();
            } else {
              document.getElementById('student-nav').style.display = 'block';
              document.getElementById('mobile-student-nav').style.display = 'block';
              document.getElementById('student-features').style.display = 'block';
              loadStudentClasses();
            }
          }
        })
        .catch(error => console.error('Error loading user info:', error));
    }

    // Navigation Setup
    function setupNavigation() {
      // Desktop navigation
      document.querySelectorAll('[data-section]').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          
          // Update active nav link
          document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
          this.classList.add('active');
          
          // Show section
          const sectionId = this.dataset.section + '-section';
          currentSection = sectionId;
          document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
          document.getElementById(sectionId).classList.add('active');
          
          // Load section-specific data
          loadSectionData(sectionId);
        });
      });
    }

    function loadSectionData(sectionId) {
      switch(sectionId) {
        case 'profile-section':
          loadActivities();
          loadAssessmentDashboard();
          break;
        case 'notes-section':
          loadUserNotes();
          break;
        case 'assessment-section':
          checkAssessmentAvailability();
          break;
        case 'teacher-dashboard-section':
          loadTeacherDashboard();
          break;
        case 'student-classes-section':
          loadStudentClasses();
          loadAvailableClasses();
          break;
      }
    }

    // Event Listeners Setup
    function setupEventListeners() {
      document.getElementById('upload-form').addEventListener('submit', handleFormSubmit);
      document.getElementById('ask-btn').addEventListener('click', handleAskQuestion);
      document.getElementById('user-question').addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          handleAskQuestion();
        }
      });
      document.getElementById('video-search').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          searchVideos();
        }
      });

      // Teacher form listeners
      const createClassForm = document.getElementById('create-class-form');
      if (createClassForm) {
        createClassForm.addEventListener('submit', handleCreateClass);
      }

      // File upload form listener
      const fileUploadForm = document.getElementById('file-upload-form');
      if (fileUploadForm) {
        fileUploadForm.addEventListener('submit', handleFileUpload);
      }

      // Class selection for file upload
      const fileUploadClassSelect = document.getElementById('file-upload-class');
      if (fileUploadClassSelect) {
        fileUploadClassSelect.addEventListener('change', function() {
          const form = document.getElementById('file-upload-form');
          if (this.value) {
            form.style.display = 'block';
          } else {
            form.style.display = 'none';
          }
        });
      }
    }

    // PDF Extraction Setup
    function setupPDFExtraction() {
      const fileInput = document.getElementById('file-input');
      fileInput.addEventListener('change', handleFileSelect);
    }

    async function handleFileSelect(e) {
      const file = e.target.files[0];
      if (!file) return;

      try {
        let extractedText = '';
        
        if (file.type === 'application/pdf') {
          extractedText = await extractPDFText(file);
        } else if (file.type === 'text/plain') {
          extractedText = await file.text();
        } else if (file.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
          // Let server handle DOCX
          return;
        }

        if (extractedText) {
          showNotification(`Text extracted successfully! (${extractedText.length} characters)`, 'success');
        }
      } catch (error) {
        console.error('Error extracting text:', error);
        showNotification('Could not extract text. File will be processed on server.', 'info');
      }
    }

    async function extractPDFText(file) {
      try {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
        let fullText = '';

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(' ');
          fullText += pageText + '\n';
        }

        return fullText.trim();
      } catch (error) {
        console.error('Error extracting PDF text:', error);
        return '';
      }
    }

    // Form Submission with Text Extraction
    async function handleFormSubmit(e) {
      e.preventDefault();
      
      if (isProcessing) return;
      isProcessing = true;

      const formData = new FormData(e.target);
      const file = formData.get('file');
      const includeAudio = document.getElementById('include-audio-toggle').checked;
      
      // Add audio preference
      formData.append('include_audio', includeAudio);
      
      // Add extracted text if available
      if (file && file.type === 'application/pdf') {
        try {
          const extractedText = await extractPDFText(file);
          if (extractedText) {
            formData.append('extracted_text', extractedText);
          }
        } catch (error) {
          console.error('Error extracting PDF text:', error);
        }
      }

      const submitBtn = e.target.querySelector('button[type="submit"]');
      const originalText = submitBtn.innerHTML;
      
      submitBtn.innerHTML = '<span class="loading-spinner"></span> Processing...';
      submitBtn.disabled = true;
      showProgress();

      try {
        const response = await fetch('/process', {
          method: 'POST',
          body: formData
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        const data = await response.json();
        summaryContext = data.summary_text;

        // Show summary
        document.getElementById('summary-content').innerHTML = marked.parse(data.summary_text);
        document.getElementById('summary-section').style.display = 'block';

        // Setup audio if included
        const audioSection = document.getElementById('audio-section');
        if (data.audio_url && includeAudio) {
          document.getElementById('audio-source').src = data.audio_url;
          document.getElementById('audio-player').load();
          audioSection.style.display = 'block';
        } else {
          audioSection.style.display = 'none';
        }

        // Enable assessment
        checkAssessmentAvailability();
        
        // Enable "Use Current Document" button for AI notes
        document.getElementById('use-summary-btn').disabled = false;

        showNotification('Document processed successfully!', 'success');

      } catch (error) {
        console.error('Error processing file:', error);
        showNotification('Failed to process file. Please try again.', 'error');
      } finally {
        submitBtn.innerHTML = originalText;
        submitBtn.disabled = false;
        hideProgress();
        isProcessing = false;
      }
    }

    // Chat Functions
    async function handleAskQuestion() {
      const questionInput = document.getElementById('user-question');
      const question = questionInput.value.trim();
      
      if (!question) return;

      const askBtn = document.getElementById('ask-btn');
      
      addChatMessage(question, 'user');
      questionInput.value = '';

      askBtn.innerHTML = '<span class="loading-spinner"></span>';
      askBtn.disabled = true;

      try {
        const response = await fetch('/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ question, context: summaryContext })
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        const data = await response.json();
        if (data.videos) {
          displayVideos(data.videos);
          addChatMessage('I found some videos related to your question! Check the Videos section.', 'ai');
        } else if (data.answer) {
          addChatMessage(data.answer, 'ai');
        }

      } catch (error) {
        console.error('Error asking question:', error);
        addChatMessage('Sorry, I encountered an error. Please try again.', 'ai');
      } finally {
        askBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
        askBtn.disabled = false;
      }
    }

    function addChatMessage(content, sender) {
      const chatMessages = document.getElementById('chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'chat-message';
      
      if (sender === 'user') {
        messageDiv.innerHTML = `
          <div class="message-bubble user">
            <strong><i class="fas fa-user"></i> You:</strong>
            <p>${escapeHtml(content)}</p>
          </div>
        `;
      } else {
        const html = marked.parse(content);
        messageDiv.innerHTML = `
          <div class="message-bubble ai">
            <strong><i class="fas fa-robot"></i> H.ai:</strong>
            <div>${html}</div>
          </div>
        `;
      }
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Video Search Functions
    async function searchVideos() {
      const query = document.getElementById('video-search').value.trim();
      if (!query) return;

      const container = document.getElementById('videos-container');
      container.innerHTML = '<div class="text-center"><div class="loading-spinner"></div> Searching videos...</div>';

      try {
        const response = await fetch('/search_videos', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query })
        });

        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

        const data = await response.json();
        displayVideos(data.videos);

      } catch (error) {
        console.error('Error searching videos:', error);
        container.innerHTML = '<div class="text-center text-danger">Error searching videos. Please try again.</div>';
      }
    }

    function displayVideos(videos) {
      const container = document.getElementById('videos-container');
      
      if (!videos || videos.length === 0) {
        container.innerHTML = '<div class="text-center text-muted">No videos found. Try a different search term.</div>';
        return;
      }

      const videosHtml = videos.map(video => `
        <div class="video-card" onclick="playVideo('${video.id}', '${escapeHtml(video.title)}')" role="button" tabindex="0">
          <img src="${video.thumbnails[0]}" alt="${escapeHtml(video.title)}" class="video-thumbnail" loading="lazy">
          <div class="video-info">
            <div class="video-title">${escapeHtml(video.title)}</div>
            <div class="video-meta">
              <i class="fas fa-user"></i> ${escapeHtml(video.channel)} ‚Ä¢ 
              <i class="fas fa-clock"></i> ${escapeHtml(video.duration)} ‚Ä¢ 
              <i class="fas fa-eye"></i> ${escapeHtml(video.views)}
            </div>
            <div class="video-meta">
              <i class="fas fa-calendar"></i> ${escapeHtml(video.publish_time)}
            </div>
          </div>
        </div>
      `).join('');

      container.innerHTML = `
        <div class="mb-3">
          <strong>${videos.length} videos found</strong>
        </div>
        <div class="video-grid">${videosHtml}</div>
      `;
    }

    function playVideo(videoId, videoTitle) {
      currentVideoId = videoId;
      document.getElementById('video-modal-title').textContent = videoTitle;
      document.getElementById('video-iframe').src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
      
      // Reset video chat
      document.getElementById('video-chat-messages').innerHTML = `
        <div class="text-center text-muted p-3">
          <i class="fas fa-play-circle fa-2x mb-2"></i>
          <p>Load the video transcript to start asking questions about the content!</p>
        </div>
      `;
      document.getElementById('video-question-input').disabled = true;
      document.getElementById('ask-video-btn').disabled = true;
      document.getElementById('load-transcript-btn').disabled = false;
      
      document.getElementById('video-modal').classList.add('show');
    }

    function closeVideoModal() {
      document.getElementById('video-modal').classList.remove('show');
      document.getElementById('video-iframe').src = '';
      currentVideoId = null;
      currentVideoTranscript = null;
    }

    // Enhanced Video Chat Functions
    async function loadVideoTranscript() {
      if (!currentVideoId) return;

      const loadBtn = document.getElementById('load-transcript-btn');
      const originalText = loadBtn.innerHTML;
      loadBtn.innerHTML = '<span class="loading-spinner"></span> Loading...';
      loadBtn.disabled = true;

      try {
        const response = await fetch('/get_video_transcript', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ video_id: currentVideoId })
        });

        const data = await response.json();
        
        if (data.success) {
          currentVideoTranscript = data.transcript;
          document.getElementById('video-chat-messages').innerHTML = `
            <div class="alert alert-success">
              <i class="fas fa-check-circle"></i> Transcript loaded successfully! 
              <small class="d-block">You can now ask questions about the video content.</small>
            </div>
          `;
          document.getElementById('video-question-input').disabled = false;
          document.getElementById('ask-video-btn').disabled = false;
          document.getElementById('load-transcript-btn').innerHTML = '<i class="fas fa-check"></i> Loaded';
        } else {
          throw new Error(data.error || 'Failed to load transcript');
        }
      } catch (error) {
        console.error('Error loading transcript:', error);
        document.getElementById('video-chat-messages').innerHTML = `
          <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle"></i> Could not load transcript for this video. 
            <small class="d-block">Transcripts may not be available for all videos.</small>
          </div>
        `;
      } finally {
        loadBtn.innerHTML = originalText;
        loadBtn.disabled = true;
      }
    }

    async function askVideoQuestion() {
      const input = document.getElementById('video-question-input');
      const question = input.value.trim();
      
      if (!question || !currentVideoTranscript) return;

      const askBtn = document.getElementById('ask-video-btn');
      const originalText = askBtn.innerHTML;
      
      // Add user message to chat
      addVideoMessage(question, 'user');
      input.value = '';

      askBtn.innerHTML = '<span class="loading-spinner"></span>';
      askBtn.disabled = true;

      try {
        const response = await fetch('/ask_video', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            question: question,
            transcript: currentVideoTranscript
          })
        });

        const data = await response.json();
        
        if (data.answer) {
          addVideoMessage(data.answer, 'ai');
        } else {
          throw new Error('No response received');
        }
      } catch (error) {
        console.error('Error asking video question:', error);
        addVideoMessage('Sorry, I encountered an error processing your question about the video.', 'ai');
      } finally {
        askBtn.innerHTML = originalText;
        askBtn.disabled = false;
      }
    }

    function addVideoMessage(content, sender) {
      const messagesContainer = document.getElementById('video-chat-messages');
      const messageDiv = document.createElement('div');
      messageDiv.className = 'mb-3';
      
      if (sender === 'user') {
        messageDiv.innerHTML = `
          <div class="d-flex justify-content-end">
            <div class="bg-primary text-white rounded p-2" style="max-width: 80%;">
              <strong>You:</strong> ${escapeHtml(content)}
            </div>
          </div>
        `;
      } else {
        const html = marked.parse(content);
        messageDiv.innerHTML = `
          <div class="d-flex justify-content-start">
            <div class="bg-light rounded p-2" style="max-width: 80%;">
              <strong><i class="fas fa-robot text-primary"></i> AI:</strong>
              <div class="mt-1">${html}</div>
            </div>
          </div>
        `;
      }
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    // Video question input enter key handler
    document.addEventListener('DOMContentLoaded', function() {
      const videoInput = document.getElementById('video-question-input');
      if (videoInput) {
        videoInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            askVideoQuestion();
          }
        });
      }
    });

    // Notification Functions
    function toggleNotifications() {
      const panel = document.getElementById('notifications-panel');
      if (panel.style.display === 'block') {
        panel.style.display = 'none';
      } else {
        panel.style.display = 'block';
        loadNotifications();
      }
    }

    async function loadNotifications() {
      try {
        const response = await fetch('/get_notifications');
        const data = await response.json();
        
        if (data.success) {
          notifications = data.notifications;
          updateNotificationUI();
        }
      } catch (error) {
        console.error('Error loading notifications:', error);
      }
    }

    function updateNotificationUI() {
      const unread = notifications.filter(n => !n.is_read).length;
      const badge = document.getElementById('notification-count');
      const mobileBadge = document.getElementById('mobile-notification-badge');
      
      if (unread > 0) {
        badge.textContent = unread;
        badge.style.display = 'block';
        if (mobileBadge) {
          mobileBadge.textContent = unread;
          mobileBadge.style.display = 'inline';
        }
      } else {
        badge.style.display = 'none';
        if (mobileBadge) {
          mobileBadge.style.display = 'none';
        }
      }

      const notificationsList = document.getElementById('notifications-list');
      if (notifications.length === 0) {
        notificationsList.innerHTML = `
          <div class="text-center p-4 text-muted">
            <i class="fas fa-bell fa-2x mb-2"></i>
            <p>No notifications</p>
          </div>
        `;
      } else {
        notificationsList.innerHTML = notifications.map(notification => `
          <div class="notification-item ${!notification.is_read ? 'unread' : ''}" 
               onclick="handleNotificationClick('${notification.id}', '${notification.type}', '${notification.class_id || ''}')">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <h6 class="mb-1">${notification.title}</h6>
                <p class="mb-1 small">${notification.message}</p>
                ${notification.sender_name ? `<small class="text-muted">From: ${notification.sender_name}</small>` : ''}
              </div>
              <small class="text-muted">${formatDate(notification.created_at)}</small>
            </div>
            ${notification.type === 'class_invite' ? `
              <div class="mt-2">
                <button class="btn btn-sm btn-success me-2" onclick="event.stopPropagation(); respondToClassInvite('${notification.class_id}', 'accept', '${notification.id}')">
                  <i class="fas fa-check"></i> Accept
                </button>
                <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); respondToClassInvite('${notification.class_id}', 'decline', '${notification.id}')">
                  <i class="fas fa-times"></i> Decline
                </button>
              </div>
            ` : ''}
          </div>
        `).join('');
      }

      // Update student notifications tab
      const studentNotificationsList = document.getElementById('student-notifications-list');
      if (studentNotificationsList) {
        if (notifications.length === 0) {
          studentNotificationsList.innerHTML = `
            <div class="text-center p-4 text-muted">
              <i class="fas fa-bell fa-2x mb-3"></i>
              <p>No notifications</p>
            </div>
          `;
        } else {
          studentNotificationsList.innerHTML = notifications.map(notification => `
            <div class="notification-item ${!notification.is_read ? 'unread' : ''}">
              <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1">
                  <h6 class="mb-1">${notification.title}</h6>
                  <p class="mb-1">${notification.message}</p>
                  ${notification.sender_name ? `<small class="text-muted d-block">From: ${notification.sender_name}</small>` : ''}
                  <small class="text-muted">${formatDate(notification.created_at)}</small>
                </div>
                ${!notification.is_read ? '<div class="badge bg-primary">New</div>' : ''}
              </div>
              ${notification.type === 'class_invite' ? `
                <div class="mt-3">
                  <button class="btn btn-success btn-sm me-2" onclick="respondToClassInvite('${notification.class_id}', 'accept', '${notification.id}')">
                    <i class="fas fa-check"></i> Accept Invitation
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="respondToClassInvite('${notification.class_id}', 'decline', '${notification.id}')">
                    <i class="fas fa-times"></i> Decline
                  </button>
                </div>
              ` : ''}
            </div>
          `).join('');
        }
      }
    }

    function handleNotificationClick(notificationId, type, classId) {
      // Mark as read
      markNotificationRead(notificationId);
      
      // Handle different notification types
      if (type === 'class_invite') {
        // Already handled by buttons
        return;
      } else if (type === 'file_upload' && classId) {
        // Navigate to class files
        showSection('student-classes-section');
        // TODO: Show specific class files
      }
    }

    async function markNotificationRead(notificationId) {
      try {
        await fetch('/mark_notification_read', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ notification_id: notificationId })
        });
        
        // Update local notifications
        const notification = notifications.find(n => n.id.toString() === notificationId.toString());
        if (notification) {
          notification.is_read = true;
          updateNotificationUI();
        }
      } catch (error) {
        console.error('Error marking notification as read:', error);
      }
    }

    async function respondToClassInvite(classId, response, notificationId) {
      try {
        const res = await fetch('/respond_to_class_invite', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            class_id: classId, 
            response: response,
            notification_id: notificationId
          })
        });

        const data = await res.json();
        
        if (data.success) {
          showNotification(data.message, 'success');
          loadNotifications();
          loadStudentClasses();
        } else {
          showNotification(data.error || 'Error responding to invitation', 'error');
        }
      } catch (error) {
        console.error('Error responding to class invite:', error);
        showNotification('Error responding to invitation', 'error');
      }
    }

    // Teacher Dashboard Functions
    async function loadTeacherDashboard() {
      if (currentUser && currentUser.role === 'teacher') {
        loadTeacherClasses();
        loadTeacherStats();
        loadAllStudents();
        loadTeacherClassesForSelect();
      }
    }

    async function loadTeacherStats() {
      try {
        const response = await fetch('/get_teacher_classes');
        const data = await response.json();
        
        if (data.success) {
          const totalClasses = data.classes.length;
          const totalStudents = data.classes.reduce((sum, c) => sum + c.student_count, 0);
          
          document.getElementById('total-classes').textContent = totalClasses;
          document.getElementById('total-students').textContent = totalStudents;
          document.getElementById('pending-requests').textContent = '0'; // TODO: Implement
        }
      } catch (error) {
        console.error('Error loading teacher stats:', error);
      }
    }

    async function loadTeacherClasses() {
      try {
        const response = await fetch('/get_teacher_classes');
        const data = await response.json();
        
        const container = document.getElementById('teacher-classes-list');
        if (data.success && data.classes.length > 0) {
          container.innerHTML = data.classes.map(cls => `
            <div class="class-card" onclick="viewClassDetails('${cls.id}')">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-1">${cls.name}</h6>
                <span class="badge bg-primary">${cls.student_count} students</span>
              </div>
              <p class="text-muted small mb-2">${cls.description || 'No description'}</p>
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-muted">Code: ${cls.class_code}</small>
                <small class="text-muted">${formatDate(cls.created_at)}</small>
              </div>
            </div>
          `).join('');
        } else {
          container.innerHTML = `
            <div class="text-center text-muted py-4">
              <i class="fas fa-plus-circle fa-3x mb-3"></i>
              <p>No classes yet. Create your first class!</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading teacher classes:', error);
      }
    }

    async function loadAllStudents() {
      try {
        const response = await fetch('/get_all_students');
        const data = await response.json();
        
        if (data.success) {
          const container = document.getElementById('students-selection');
          container.innerHTML = data.students.map(student => `
            <div class="form-check">
              <input class="form-check-input" type="checkbox" value="${student.id}" id="student-${student.id}">
              <label class="form-check-label" for="student-${student.id}">
                <strong>${student.username}</strong> (${student.email})
                ${student.institution ? `<small class="text-muted d-block">${student.institution}</small>` : ''}
              </label>
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('Error loading students:', error);
      }
    }

    async function loadTeacherClassesForSelect() {
      try {
        const response = await fetch('/get_teacher_classes');
        const data = await response.json();
        
        if (data.success) {
          const selects = [
            'file-upload-class',
            'announcement-class',
            'class-filter',
            'reports-class-filter'
          ];
          
          selects.forEach(selectId => {
            const select = document.getElementById(selectId);
            if (select) {
              const currentValue = select.value;
              select.innerHTML = '<option value="">Select a class</option>' + 
                data.classes.map(cls => 
                  `<option value="${cls.id}">${cls.name}</option>`
                ).join('');
              select.value = currentValue;
            }
          });
        }
      } catch (error) {
        console.error('Error loading classes for selects:', error);
      }
    }

    function showCreateClassModal() {
      loadAllStudents();
      document.getElementById('create-class-modal').classList.add('show');
    }

    function closeCreateClassModal() {
      document.getElementById('create-class-modal').classList.remove('show');
      document.getElementById('create-class-form').reset();
    }

    async function handleCreateClass(e) {
      e.preventDefault();
      
      const name = document.getElementById('new-class-name').value.trim();
      const description = document.getElementById('new-class-description').value.trim();
      const selectedStudents = Array.from(document.querySelectorAll('#students-selection input:checked'))
        .map(input => input.value);

      if (!name) {
        showNotification('Please enter a class name', 'error');
        return;
      }

      try {
        const response = await fetch('/create_class', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: name,
            description: description,
            students: selectedStudents
          })
        });

        const data = await response.json();
        
        if (data.success) {
          showNotification(`Class "${name}" created successfully!`, 'success');
          closeCreateClassModal();
          loadTeacherDashboard();
        } else {
          showNotification(data.error || 'Error creating class', 'error');
        }
      } catch (error) {
        console.error('Error creating class:', error);
        showNotification('Error creating class', 'error');
      }
    }

    // Student Dashboard Functions
    async function loadStudentClasses() {
      try {
        const response = await fetch('/get_student_classes');
        const data = await response.json();
        
        const container = document.getElementById('student-enrolled-classes');
        if (data.success && data.classes.length > 0) {
          container.innerHTML = data.classes.map(cls => `
            <div class="student-class-card enrolled" onclick="viewStudentClass('${cls.id}')">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-1">${cls.name}</h6>
                <span class="badge bg-success">Joined</span>
              </div>
              <p class="text-muted small mb-2">${cls.description || 'No description'}</p>
              <div class="d-flex justify-content-between align-items-center">
                <small><i class="fas fa-user"></i> ${cls.teacher_name}</small>
                <small><i class="fas fa-file"></i> ${cls.file_count} files</small>
              </div>
              <small class="text-muted">Joined: ${formatDate(cls.joined_at)}</small>
            </div>
          `).join('');
        } else {
          container.innerHTML = `
            <div class="text-center text-muted py-5">
              <i class="fas fa-users fa-3x mb-3"></i>
              <p>You haven't joined any classes yet. Browse available classes to get started!</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading student classes:', error);
      }
    }

    async function loadAvailableClasses() {
      try {
        const response = await fetch('/get_available_classes');
        const data = await response.json();
        
        const container = document.getElementById('student-available-classes');
        if (data.success && data.classes.length > 0) {
          container.innerHTML = data.classes.map(cls => `
            <div class="student-class-card">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-1">${cls.name}</h6>
                <button class="btn btn-sm btn-primary" onclick="requestJoinClass('${cls.id}', '${cls.name}')">
                  <i class="fas fa-plus"></i> Request Join
                </button>
              </div>
              <p class="text-muted small mb-2">${cls.description || 'No description'}</p>
              <div class="d-flex justify-content-between align-items-center">
                <small><i class="fas fa-user"></i> ${cls.teacher_name}</small>
                <small><i class="fas fa-users"></i> ${cls.member_count} members</small>
              </div>
              <small class="text-muted">Created: ${formatDate(cls.created_at)}</small>
            </div>
          `).join('');
        } else {
          container.innerHTML = `
            <div class="text-center text-muted py-5">
              <i class="fas fa-search fa-3x mb-3"></i>
              <p>No available classes found at the moment.</p>
            </div>
          `;
        }
      } catch (error) {
        console.error('Error loading available classes:', error);
      }
    }

    async function requestJoinClass(classId, className) {
      try {
        const response = await fetch('/request_class_join', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ class_id: classId })
        });

        const data = await response.json();
        
        if (data.success) {
          showNotification(data.message, 'success');
          loadAvailableClasses();
        } else {
          showNotification(data.error || 'Error sending request', 'error');
        }
      } catch (error) {
        console.error('Error requesting class join:', error);
        showNotification('Error sending join request', 'error');
      }
    }

    function viewStudentClass(classId) {
      // TODO: Implement class detail view for students
      showNotification('Class details view coming soon!', 'info');
    }

    // File Upload Functions
    async function handleFileUpload(e) {
      e.preventDefault();
      
      const classId = document.getElementById('file-upload-class').value;
      const fileInput = document.getElementById('class-file-input');
      const description = document.getElementById('file-description').value;
      
      if (!classId || !fileInput.files[0]) {
        showNotification('Please select a class and file', 'error');
        return;
      }

      const formData = new FormData();
      formData.append('class_id', classId);
      formData.append('file', fileInput.files[0]);
      formData.append('description', description);

      try {
        const response = await fetch('/upload_class_file', {
          method: 'POST',
          body: formData
        });

        const data = await response.json();
        
        if (data.success) {
          showNotification('File uploaded successfully!', 'success');
          document.getElementById('file-upload-form').reset();
          loadClassFiles(classId);
        } else {
          showNotification(data.error || 'Error uploading file', 'error');
        }
      } catch (error) {
        console.error('Error uploading file:', error);
        showNotification('Error uploading file', 'error');
      }
    }

    async function loadClassFiles(classId) {
      if (!classId) return;
      
      try {
        const response = await fetch(`/get_class_files/${classId}`);
        const data = await response.json();
        
        const container = document.getElementById('class-files-list');
        if (data.success && data.files.length > 0) {
          container.innerHTML = `
            <h6 class="mt-3 mb-2">Class Files</h6>
            ${data.files.map(file => `
              <div class="file-item">
                <div class="flex-grow-1">
                  <strong>${file.filename}</strong>
                  ${file.description ? `<small class="d-block text-muted">${file.description}</small>` : ''}
                  <small class="text-muted">${formatFileSize(file.file_size)} ‚Ä¢ ${formatDate(file.uploaded_at)}</small>
                </div>
                <button class="btn btn-sm btn-outline-primary" onclick="downloadFile('${file.id}')">
                  <i class="fas fa-download"></i>
                </button>
              </div>
            `).join('')}
          `;
        } else {
          container.innerHTML = '<p class="text-muted mt-3">No files uploaded yet.</p>';
        }
      } catch (error) {
        console.error('Error loading class files:', error);
      }
    }

    function downloadFile(fileId) {
      window.open(`/download_class_file/${fileId}`, '_blank');
    }

    // Notes Functions (keeping existing ones)
    async function loadUserNotes() {
      try {
        const response = await fetch('/get_user_notes');
        const data = await response.json();
        
        if (data.success) {
          userNotes = data.notes;
          displayNotesList();
        }
      } catch (error) {
        console.error('Error loading notes:', error);
      }
    }

    function displayNotesList() {
      const container = document.getElementById('notes-grid');
      
      if (userNotes.length === 0) {
        container.innerHTML = `
          <div class="text-center text-muted mt-5 w-100">
            <i class="fas fa-sticky-note fa-3x mb-3"></i>
            <p>No notes yet. Create your first note!</p>
          </div>
        `;
        return;
      }

      const notesHtml = userNotes.map(note => `
        <div class="note-card" onclick="openNote(${note.id})" role="button" tabindex="0">
          <div class="note-actions">
            <button class="note-action-btn" onclick="event.stopPropagation(); editNote(${note.id})" title="Edit">
              <i class="fas fa-edit"></i>
            </button>
            <button class="note-action-btn" onclick="event.stopPropagation(); deleteNote(${note.id})" title="Delete">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="note-card-header">
            <h5 class="note-title">${escapeHtml(note.title)}</h5>
            <span class="note-date">${formatDate(note.updated_at)}</span>
          </div>
          <div class="note-preview">${getTextPreview(note.content)}</div>
        </div>
      `).join('');

      container.innerHTML = `<div class="notes-grid">${notesHtml}</div>`;
    }

    function getTextPreview(htmlContent) {
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = htmlContent;
      const textContent = tempDiv.textContent || tempDiv.innerText || '';
      return escapeHtml(textContent.substring(0, 150) + (textContent.length > 150 ? '...' : ''));
    }

    function createNewNote() {
      currentNoteId = null;
      document.getElementById('note-title').value = 'Untitled Note';
      document.getElementById('note-editor').innerHTML = '<p>Start writing your note here...</p>';
      document.getElementById('delete-note-btn').style.display = 'none';
      showNoteEditor();
    }

    function openNote(noteId) {
      const note = userNotes.find(n => n.id === noteId);
      if (note) {
        currentNoteId = noteId;
        document.getElementById('note-title').value = note.title;
        document.getElementById('note-editor').innerHTML = note.content;
        document.getElementById('delete-note-btn').style.display = 'block';
        showNoteEditor();
      }
    }

    function editNote(noteId) {
      openNote(noteId);
    }

    function showNoteEditor() {
      document.getElementById('notes-list-view').style.display = 'none';
      document.getElementById('note-editor-view').style.display = 'block';
      document.getElementById('note-editor').focus();
    }

    function backToNotesList() {
      document.getElementById('note-editor-view').style.display = 'none';
      document.getElementById('notes-list-view').style.display = 'block';
      loadUserNotes();
    }

    async function saveNote() {
      const title = document.getElementById('note-title').value.trim();
      const content = document.getElementById('note-editor').innerHTML;
      
      if (!title) {
        showNotification('Please enter a note title', 'error');
        return;
      }

      const saveBtn = document.querySelector('[onclick="saveNote()"]');
      const originalText = saveBtn.innerHTML;
      saveBtn.innerHTML = '<span class="loading-spinner"></span> Saving...';
      saveBtn.disabled = true;

      try {
        const response = await fetch('/save_note', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            id: currentNoteId,
            title: title,
            content: content
          })
        });

        const data = await response.json();
        
        if (data.success) {
          currentNoteId = data.note_id;
          document.getElementById('delete-note-btn').style.display = 'block';
          showNotification('Note saved successfully!', 'success');
        } else {
          showNotification('Error saving note: ' + data.error, 'error');
        }
      } catch (error) {
        console.error('Error saving note:', error);
        showNotification('Error saving note. Please try again.', 'error');
      } finally {
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
      }
    }

    async function deleteNote(noteId) {
      if (!confirm('Are you sure you want to delete this note?')) {
        return;
      }

      try {
        const response = await fetch('/delete_note', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ id: noteId })
        });

        const data = await response.json();
        
        if (data.success) {
          loadUserNotes();
          showNotification('Note deleted successfully!', 'success');
        } else {
          showNotification('Error deleting note: ' + data.error, 'error');
        }
      } catch (error) {
        console.error('Error deleting note:', error);
        showNotification('Error deleting note. Please try again.', 'error');
      }
    }

    async function deleteCurrentNote() {
      if (currentNoteId) {
        await deleteNote(currentNoteId);
        backToNotesList();
      }
    }

    // Editor Functions
    function formatText(command) {
      document.execCommand(command, false, null);
      document.getElementById('note-editor').focus();
    }

    function changeFontSize(size) {
      document.execCommand('fontSize', false, '7');
      const fontElements = document.querySelectorAll('font[size="7"]');
      fontElements.forEach(el => {
        el.removeAttribute('size');
        el.style.fontSize = size;
      });
      document.getElementById('note-editor').focus();
    }

    function insertCurrentDate() {
      const date = new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
      });
      document.execCommand('insertText', false, date);
      document.getElementById('note-editor').focus();
    }

    function clearContent() {
      if (confirm('Are you sure you want to clear all content?')) {
        document.getElementById('note-editor').innerHTML = '<p>Start writing your note here...</p>';
        document.getElementById('note-editor').focus();
      }
    }

    // AI Notes Functions
    function showAINotesGenerator() {
      document.getElementById('ai-notes-generator').style.display = 'block';
      document.getElementById('notes-list-view').style.display = 'none';
      
      if (summaryContext) {
        document.getElementById('use-summary-btn').disabled = false;
      }
    }

    function hideAINotesGenerator() {
      document.getElementById('ai-notes-generator').style.display = 'none';
      document.getElementById('notes-list-view').style.display = 'block';
      document.getElementById('ai-notes-preview').style.display = 'none';
      generatedAIContent = '';
    }

    function useCurrentSummary() {
      if (summaryContext) {
        document.getElementById('ai-notes-prompt').value = `Create detailed notes based on this content:\n\n${summaryContext}`;
      } else {
        showNotification('Please upload and process a document first in the Learn section.', 'error');
      }
    }

    async function generateAINotes() {
      const prompt = document.getElementById('ai-notes-prompt').value.trim();
      const style = document.getElementById('ai-notes-style').value;
      const features = document.getElementById('ai-notes-features').value;
      
      if (!prompt) {
        showNotification('Please enter what you want notes about', 'error');
        return;
      }

      const generateBtn = document.getElementById('generate-ai-notes-btn');
      const originalText = generateBtn.innerHTML;
      generateBtn.innerHTML = '<span class="loading-spinner"></span> Generating...';
      generateBtn.disabled = true;

      generatedAIContent = '';

      try {
        const response = await fetch('/generate_ai_notes', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            prompt: prompt,
            style: style,
            features: features,
            context: summaryContext || ''
          })
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        
        if (data.success && data.notes) {
          generatedAIContent = data.notes;
          document.getElementById('ai-notes-content').innerHTML = data.notes;
          document.getElementById('ai-notes-preview').style.display = 'block';
        } else {
          throw new Error(data.error || 'Failed to generate notes');
        }
      } catch (error) {
        console.error('Error generating AI notes:', error);
        showNotification('Error generating notes: ' + error.message, 'error');
        generatedAIContent = '';
      } finally {
        generateBtn.innerHTML = originalText;
        generateBtn.disabled = false;
      }
    }

    function regenerateAINotes() {
      generateAINotes();
    }

    function saveAINotesToEditor() {
      if (!generatedAIContent || generatedAIContent.trim() === '') {
        showNotification('No notes to save. Please generate notes first.', 'error');
        return;
      }
      
      currentNoteId = null;
      const prompt = document.getElementById('ai-notes-prompt').value.trim();
      const title = `AI Notes: ${prompt.substring(0, 50)}${prompt.length > 50 ? '...' : ''}`;
      
      document.getElementById('note-title').value = title;
      document.getElementById('note-editor').innerHTML = generatedAIContent;
      document.getElementById('delete-note-btn').style.display = 'none';
      
      hideAINotesGenerator();
      showNoteEditor();
      
      setTimeout(() => {
        saveNote();
      }, 500);
    }

    // Assessment Functions
    function checkAssessmentAvailability() {
      const generateBtn = document.getElementById('generate-btn');
      if (summaryContext) {
        generateBtn.disabled = false;
        generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Assessment';
      } else {
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<i class="fas fa-magic"></i> Process a document first';
      }
    }

    async function generateAssessment() {
      if (!summaryContext) {
        showNotification('Please upload and process a document first', 'error');
        return;
      }

      const generateBtn = document.getElementById('generate-btn');
      const originalText = generateBtn.innerHTML;
      
      generateBtn.innerHTML = '<span class="loading-spinner"></span> Generating Questions...';
      generateBtn.disabled = true;

      try {
        const response = await fetch('/generate_assessment', {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ summary: summaryContext })
        });

        if (!response.ok) {
          throw new Error(`Server error: ${response.status}`);
        }

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error);
        }
        
        if (!data.questions || data.questions.length === 0) {
          throw new Error('No questions generated');
        }

        currentAssessment = data.questions;
        userAnswers = new Array(data.questions.length).fill('');
        
        displayQuestions(data.questions);
        document.getElementById('assessment-start').style.display = 'none';
        document.getElementById('assessment-quiz').style.display = 'block';

      } catch (error) {
        console.error('Error generating assessment:', error);
        showNotification(`Failed to generate assessment: ${error.message}`, 'error');
      } finally {
        generateBtn.innerHTML = originalText;
        generateBtn.disabled = false;
      }
    }

    function displayQuestions(questions) {
      const container = document.getElementById('questions-container');
      
      const questionsHtml = questions.map((q, index) => `
        <div class="card mb-3">
          <div class="card-body">
            <h6>Question ${index + 1}</h6>
            <p class="fw-bold">${q.question}</p>
            <div class="mt-3">
              ${q.options.map(option => `
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" name="question_${index}" 
                         value="${option.charAt(0)}" onchange="saveAnswer(${index}, '${option.charAt(0)}')"
                         id="q${index}_${option.charAt(0)}">
                  <label class="form-check-label" for="q${index}_${option.charAt(0)}">${option}</label>
                </div>
              `).join('')}
            </div>
          </div>
        </div>
      `).join('');
      
      container.innerHTML = questionsHtml;
    }

    function saveAnswer(questionIndex, answer) {
      userAnswers[questionIndex] = answer;
    }

    async function submitAssessment() {
      if (userAnswers.includes('')) {
        showNotification('Please answer all questions before submitting.', 'error');
        return;
      }

      const submitBtn = document.getElementById('submit-assessment');
      submitBtn.innerHTML = '<span class="loading-spinner"></span> Evaluating...';
      submitBtn.disabled = true;

      try {
        const response = await fetch('/submit_assessment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            questions: currentAssessment,
            answers: userAnswers,
            document_title: 'Document Assessment'
          })
        });

        if (!response.ok) throw new Error('Failed to submit assessment');

        const result = await response.json();
        displayResults(result);

      } catch (error) {
        console.error('Error submitting assessment:', error);
        showNotification('Failed to submit assessment. Please try again.', 'error');
      } finally {
        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Submit Assessment';
        submitBtn.disabled = false;
      }
    }

    function displayResults(result) {
      document.getElementById('assessment-quiz').style.display = 'none';
      document.getElementById('assessment-results').style.display = 'block';
      
      const icon = result.passed ? 
        '<i class="fas fa-trophy fa-4x text-success"></i>' : 
        '<i class="fas fa-times-circle fa-4x text-danger"></i>';
      
      document.getElementById('result-icon').innerHTML = icon;
      document.getElementById('result-title').textContent = result.passed ? 
        'Congratulations! You Passed!' : 'Keep Learning!';
      document.getElementById('score-display').textContent = result.score + '%';
      document.getElementById('correct-display').textContent = 
        `${result.correct_count}/${result.total_questions}`;
      document.getElementById('status-display').textContent = result.passed ? 'Passed' : 'Failed';
      document.getElementById('status-display').className = result.passed ? 'text-success' : 'text-danger';
      document.getElementById('ai-feedback').innerHTML = marked.parse(result.feedback);
    }

    function resetAssessment() {
      document.getElementById('assessment-results').style.display = 'none';
      document.getElementById('assessment-start').style.display = 'block';
      currentAssessment = null;
      userAnswers = [];
      checkAssessmentAvailability();
    }

    // Load Activities
    function loadActivities() {
      fetch('/get_activities')
        .then(response => response.json())
        .then(activities => {
          const container = document.getElementById('activities-container');
          
          if (activities.length === 0) {
            container.innerHTML = '<div class="text-center text-muted">No activities yet</div>';
            return;
          }

          const activitiesHtml = activities.map(activity => `
            <div class="activity-item d-flex justify-content-between align-items-center p-3 border-bottom">
              <div>
                <strong>${activity.action}</strong>
                ${activity.details ? `<br><small class="text-muted">${activity.details}</small>` : ''}
              </div>
              <small class="text-muted">${formatDate(activity.timestamp)}</small>
            </div>
          `).join('');

          container.innerHTML = activitiesHtml;
        })
        .catch(error => {
          console.error('Error loading activities:', error);
          document.getElementById('activities-container').innerHTML = 
            '<div class="text-center text-danger">Error loading activities</div>';
        });
    }

    // Load Assessment Dashboard
    async function loadAssessmentDashboard() {
      const container = document.getElementById('assessment-dashboard');
      
      try {
        const response = await fetch('/get_assessment_history');
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.error) {
          container.innerHTML = '<div class="text-center text-warning">Please log in to view assessment history</div>';
          return;
        }
        
        if (data.assessments.length === 0) {
          container.innerHTML = `
            <div class="text-center text-muted">
              <i class="fas fa-clipboard-list fa-3x mb-3"></i>
              <p>No assessments taken yet</p>
              <small>Complete your first assessment to see your progress here</small>
            </div>`;
          return;
        }

        const stats = data.stats;
        const dashboardHtml = `
          <div class="row g-3 mb-4">
            <div class="col-6 col-md-3">
              <div class="text-center">
                <h4 class="text-primary">${stats.total_attempted}</h4>
                <small>Total</small>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="text-center">
                <h4 class="text-success">${stats.passed_count}</h4>
                <small>Passed</small>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="text-center">
                <h4 class="text-info">${stats.pass_rate.toFixed(1)}%</h4>
                <small>Pass Rate</small>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="text-center">
                <h4 class="text-warning">${stats.average_score}</h4>
                <small>Avg Score</small>
              </div>
            </div>
          </div>
          <h5>Recent Assessments</h5>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>Document</th>
                  <th>Score</th>
                  <th>Status</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody>
                ${data.assessments.map(a => `
                  <tr>
                    <td>${a.document_title}</td>
                    <td><span class="badge ${a.score >= 80 ? 'bg-success' : 'bg-danger'}">${a.score}%</span></td>
                    <td><span class="badge ${a.passed ? 'bg-success' : 'bg-danger'}">${a.passed ? 'Passed' : 'Failed'}</span></td>
                    <td>${formatDate(a.created_at)}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
        `;
        
        container.innerHTML = dashboardHtml;
        
      } catch (error) {
        console.error('Error loading assessment dashboard:', error);
        container.innerHTML = `
          <div class="text-center text-danger">
            <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
            <p>Error loading assessment data</p>
            <small>Please try refreshing the page</small>
          </div>`;
      }
    }

    // PDF Download Function
    async function downloadNotePDF() {
      const title = document.getElementById('note-title').value.trim();
      const content = document.getElementById('note-editor').innerHTML;
      
      if (!title || !content) {
        showNotification('Please add content to your note before downloading', 'error');
        return;
      }

      const downloadBtn = document.querySelector('[onclick="downloadNotePDF()"]');
      const originalText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = '<span class="loading-spinner"></span> Generating...';
      downloadBtn.disabled = true;

      try {
        const response = await fetch('/download_note_pdf', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            title: title,
            content: content
          })
        });

        if (response.ok) {
          const blob = await response.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `${title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.pdf`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);
          showNotification('PDF downloaded successfully!', 'success');
        } else {
          throw new Error('Failed to generate PDF');
        }
      } catch (error) {
        console.error('Error downloading PDF:', error);
        showNotification('Error downloading PDF. Please try again.', 'error');
      } finally {
        downloadBtn.innerHTML = originalText;
        downloadBtn.disabled = false;
      }
    }

    // Utility Functions
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    function showProgress() {
      const progressBar = document.getElementById('progress-bar');
      const progressFill = document.getElementById('progress-fill');
      
      progressBar.style.display = 'block';
      
      let width = 0;
      const interval = setInterval(() => {
        width += Math.random() * 15;
        if (width >= 90) {
          clearInterval(interval);
          width = 90;
        }
        progressFill.style.width = width + '%';
      }, 500);
      
      progressBar._interval = interval;
    }

    function hideProgress() {
      const progressBar = document.getElementById('progress-bar');
      const progressFill = document.getElementById('progress-fill');
      
      if (progressBar._interval) {
        clearInterval(progressBar._interval);
      }
      
      progressFill.style.width = '100%';
      
      setTimeout(() => {
        progressBar.style.display = 'none';
        progressFill.style.width = '0%';
      }, 500);
    }

    function escapeHtml(unsafe) {
      return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        ${message}
      `;
      
      const container = document.getElementById('notification-container');
      if (!container) {
        const newContainer = document.createElement('div');
        newContainer.id = 'notification-container';
        document.body.appendChild(newContainer);
      }
      
      document.getElementById('notification-container').appendChild(notification);
      
      setTimeout(() => {
        notification.classList.add('show');
      }, 100);
      
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 4000);
    }

    function showSection(sectionId) {
      // Update active nav link
      document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
      document.querySelector(`[data-section="${sectionId.replace('-section', '')}"]`).classList.add('active');
      
      // Show section
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      currentSection = sectionId;
      
      // Load section-specific data
      loadSectionData(sectionId);
    }

    // Handle keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      // Ctrl+S to save note
      if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        if (currentSection === 'notes-section' && document.getElementById('note-editor-view').style.display !== 'none') {
          saveNote();
        }
      }
      
      // Escape to close modals
      if (e.key === 'Escape') {
        const modal = document.querySelector('.modal-overlay.show');
        if (modal) {
          modal.classList.remove('show');
        }
      }
    });

    // Handle accessibility - keyboard navigation for video cards
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Enter' || e.key === ' ') {
        const target = e.target;
        if (target.classList.contains('video-card')) {
          e.preventDefault();
          target.click();
        }
      }
    });

    // Click outside to close notifications
    document.addEventListener('click', function(e) {
      if (!e.target.closest('#notifications-panel') && !e.target.closest('#notifications-btn')) {
        document.getElementById('notifications-panel').style.display = 'none';
      }
    });

    // Handle modal clicks
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal-overlay')) {
        e.target.classList.remove('show');
      }
    });

    // AI Teaching Assistant Functions (placeholders)
    function showAILessonPlan() {
      showNotification('AI Lesson Plan generator coming soon!', 'info');
    }

    function showAIQuizGenerator() {
      showNotification('AI Quiz generator coming soon!', 'info');
    }

    function showStudentInsights() {
      showNotification('Student insights feature coming soon!', 'info');
    }

    function showTeachingTips() {
      showNotification('Teaching tips feature coming soon!', 'info');
    }

    function viewClassDetails(classId) {
      showNotification('Class details view coming soon!', 'info');
    }

    function filterStudentsByClass() {
      const classId = document.getElementById('class-filter').value;
      showNotification('Student filtering coming soon!', 'info');
    }
  </script>
</body>
</html>
